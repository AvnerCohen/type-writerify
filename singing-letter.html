<!DOCTYPE html>
<head>
    <title>
        Type Writer Sample
    </title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" media="screen" href="./type-writer-styles.css">
   <link href='http://fonts.googleapis.com/css?family=Courgette' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="http://www.google.com/jsapi">
                
    </script>
    <script type="text/javascript">
        google.load("jquery", "1");
    </script>
                
    </script>
    <script>
 	typewriter = {};
 	typewriter.context = {
 		items : [],
 		currentItem : 0,
 	 	currentWithinItem :0,
 		currentText : "",
 		speed : 15,
 		baseSpeed : 15

 	};
 	typewriter.timeout = null;

 	typewriter.typeNext = function(){
	var target = $(".content");
	var nextElement = null;

	if(typewriter.context.currentText === ""){
		nextElement = typewriter.getNextElement();
		typewriter.context.currentText = nextElement.text();
		nextElement.text("");
		typewriter.context.currentWithinItem = 0;
		target.append(nextElement);
	} else {
		nextElement = typewriter.context.currentText.substr(typewriter.context.currentWithinItem++, 1);
		if (typewriter.context.currentText.length === typewriter.context.currentWithinItem){
			typewriter.context.currentText = ""; //Reset content
		}
		target.children().last().append(nextElement);
	}

	if (typewriter.context.currentItem <= typewriter.context.items.length){
 			typewriter.timeout = setTimeout(typewriter.typeNext, typewriter.getRandomWait());
		};

 	};

 	typewriter.kickShow = function(){
 		//Start by creating the array of all items to walk through;
 		typewriter.context.items = $(".hidden-element").children().first().children();

 		typewriter.timeout = setTimeout(typewriter.typeNext, 100);

 	}

 	typewriter.getNextElement = function(){
 		return $(typewriter.context.items[typewriter.context.currentItem++]);
 	}

 	typewriter.getRandomWait = function(){
 	    var wait = Math.abs(Math.random() * (typewriter.context.speed * 10))
   		 return wait;
   	}


                  $(document).ready(function() {

                     var target = $(".content");
                    $(".hidden-element").load("singit", typewriter.kickShow);

                      $('#soundEffect').bind('timeupdate', function() {
                          if (this.currentTime > 1.5) {
                            this.currentTime = 0;
                          }
                      });

                      $(document.body).on("click", "button.change-speed", function() {
                          var speed = $(this).attr("data-speed")
 							typewriter.context.speed = typewriter.context.baseSpeed / speed;
                          console.log("New speed:" + speed);
                      });
                      $(document.body).on("click", "button.change-direction", function() {
                          var new_direction = $(this).attr("data-direction")
                          socket.emit("change-direction", {
                              direction: new_direction
                          });
                          console.log("New direction:" + new_direction);
                          direction = new_direction;
                      });
                  });
    </script>
   	<style>
   	body{
   		overflow:hidden;
   	}
	.wrapper{
		width:100%;
		height:100%;
		text-align:left;
	}
	div.book{
		background:url('./book.jpg') center no-repeat;
		height:558px;
		width:817px;
		position:relative;
		top:15%;
		left:25%;
	}
	div.content{
		position:relative;
		width:310px;
		top:27px;
		left:60px;
		font-size:14px;
	}
	div.control-panel{
		width:100%;
		height:10%;
		text-align:center;
		color:black;
	}
	div.hidden-element{
		visibility:hidden;
	}
	</style>
</head>
<body>
    <div id="container" dir="ltr">
        <header id="header">
            <div class="control-panel">
                <button class="change-direction" data-direction="R">
                    REWIND
                </button>
                <button class="change-speed" data-speed="-1">
                    STOP
                </button>
                <button class="change-speed" data-speed="1">
                    NORMAL
                </button>
                <button class="change-speed" data-speed="4">
                    X4
                </button>
                <button class="change-speed" data-speed="8">
                    X8
                </button>
                <button class="change-speed" data-speed="16">
                    X16
                </button>
                <button class="change-speed" data-speed="32">
                    X32
                </button>
                <button class="change-direction" data-direction="F">
                    FORWARD
                </button>
            </div>
        </header>

	<div class="wrapper">
			<div class="book">
				<div class="content">
				</div>
			</div>
	</div>

        <audio id="soundEffect" controls="controls" style="display:none">
            <source src="typewriter.mp3" type="audio/mp3" />
            Your browser does not support the audio tag.
        </audio>
<div class="hidden-element"></div>
</body>

</html>
